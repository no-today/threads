---
title: 加密算法体系
date: 2023-09-27
tags:
    - 加密
---

# 加密算法体系

- 保密性：通过加密实现，防止数据泄露
- 数据完整性：数字签名实现，防止数据被篡改
- 身份验证：通过校验签名、数字证书实现，防止身份被伪装，防抵赖

## 哈希摘要

**MD5**、**SHA256**/**512**

- **易变性**：输入发生 1 Bit 变动，就可能导致输出结果 50% 的内容发生改变。
- **输出长度固定**：无论输入长度多少，输出长度固定（2 的 N 次幂）。
- **不可逆**：即不能解密，严格来说并不是加密算法，只是一些场景把它当作加密算法使用。

**HMAC**

HMAC（Hash-based Message Authentication Code）在哈希摘要的基础上扩展了对称加密及验证功能。它基于密钥和哈希函数，用于生成一个固定长度的认证码，这个认证码用于验证消息的完整性和认证消息的发送者。

HMAC 需要一个密钥，这个密钥只有发送方和接收方知道。密钥用于增强认证的安全性，因为只有知道密钥的人才能生成正确的认证码。

常见的组合有：RS256(HmacSHA256)、RS256(SHA256withRSA)，满足对称和非对称需求。

## 对称加密

**AES**、**DES**

- **密钥一致性**：加密和解密是一样的密钥。
- 加密明文长度不受限制。
- 执行速度相对较快。
- **密钥传递问题**：要解决如何把密钥安全地传递给解密者。

## 非对称加密

**RSA**、**DSA**

- **密钥差异性：加密和解密使用的是不同的密钥。**
- 明文长度不能超过公钥长度。
- 执行速度相对较慢。

### 加密(公钥加密，私钥解密)

由于非对称加密对加密的数据有长度限制和性能问题，现代密码学通常结合对称和非对称加密。

首先使用非对称加密安全地传递少量数据(对称加密的密钥)，随后使用对称加密处理大规模数据。此应用模式被称为 "密码学套件"
，其中非对称加密起到 "密钥协商" 的作用。

### 签名(私钥加密，公钥解密)

同样因为存在加密长度问题和性能问题，现代密码学通常结合哈希函数和非对称加密来签名。

任何数据经过哈希处理后都会得到固定长度的摘要，将摘要进行签名即相当于对整个数据背书。如数据被篡改，摘要会改变，从而使签名失效。

公钥持有者可以验证消息来自私钥持有者，并确保内容未被篡改。

## 加密模式和填充

**加密模式**：

1. **CBC（Cipher Block Chaining）模式**：CBC 模式是最常见的块加密模式之一。它提供了良好的安全性，每个数据块的加密都依赖于前一个数据块的密文，增加了安全性。CBC
   模式在许多协议和应用中广泛使用，包括TLS/SSL、IPsec等。
2. **GCM（Galois/Counter Mode）**：GCM 模式结合了加密和认证，提供了高级别的数据保护，包括机密性、完整性和认证性。它在许多安全通信协议中被广泛采用，特别是在TLS
   1.2和TLS 1.3中。
3. **CTR（Counter）模式**：CTR 模式使用计数器和加密算法生成伪随机密钥流，然后将该密钥流与明文进行异或运算来加密数据。CTR
   模式具有高度的并行性和随机性，适用于多种应用。
4. **OFB（Output Feedback）模式**：OFB 模式也使用一个计数器，但它将计数器输出作为密钥流，然后与明文进行异或运算。OFB
   模式不提供认证，通常用于流加密。
5. **CFB（Cipher Feedback）模式**：CFB 模式类似于OFB，但它将前一个密文块反馈到加密算法中，然后与明文进行异或运算。CFB
   模式不太常见，但仍然有其用途。

**填充规则**：

1. **PKCS#7 Padding**：PKCS#7 填充是一种常见的填充方案，它在数据块的末尾添加了一个字节序列，序列的值等于需要填充的字节数。这是许多加密协议和库的默认填充方案。
2. **ISO 7816-4 Padding**：与 PKCS#7 填充类似，但末尾填充的字节都具有相同的值（通常是0x80）。
3. **No Padding**
   ：有时，数据块大小必须与加密算法块大小完全匹配。如果明文数据长度不是块大小的整数倍，可以通过拒绝或补齐数据来满足要求。这称为 "
   No Padding"，它在数据长度不匹配时可能导致数据被丢弃或补齐。
4. **Zero Padding**：在这种填充方案中，数据块的末尾被填充为零，直到达到块大小。

## 密钥交换算法

用于在不安全的公用信道上交换私密信息，需要确保数据的保密性和完整性。广泛用于安全通信协议，如TLS/SSL，协商对称密钥。

### DH

- **工作原理**：DH 算法基于离散对数问题。通信双方各自选择私密的随机数，并使用公共的素数和生成元作为参数，执行一系列数学运算以计算出共享的密钥。
- **安全性**：DH 提供了良好的安全性，但需要较长的密钥长度以抵御现代计算机和量子计算机的攻击。

### ECDH

- **工作原理**：ECDH 算法与传统的 DH 算法类似，但它使用椭圆曲线上的点来执行计算，而不是大整数。通信双方各自选择私密的随机数，并使用椭圆曲线上的点乘法来计算出共享的密钥。
- **安全性**：ECDH 算法在相对较短的密钥长度下提供了与传统 DH 算法相当的安全性，适用于资源受限环境。

**前向安全**：前向安全通过每次会话使用独立随机密钥的机制，保证即使长期密钥泄漏，也不会影响之前已建立的安全会话。

RSA 也可以用作密钥交换，但是它不支持前向安全，一旦私钥泄漏所有历史会话都可能被解密。

## 延伸阅读

- [一次搞懂密碼學中的三兄弟 — Encode、Encrypt 跟 Hash](https://medium.com/starbugs/what-are-encoding-encrypt-and-hashing-4b03d40e7b0c)
- [只要十分鐘，帶你看懂 TOTP 2FA 的密碼學原理](https://medium.com/starbugs/totp-2fa-algorithm-in-10-mins-25acc3c35df9)

### 字典

| 简写   | 全名                                     | 中文对照                    |
|------|----------------------------------------|-------------------------|
| MD   | Message Digest                         | 信息摘要                    |
| SHA  | Secure Hash Algorithm                  | 安全哈希算法                  |
| HMAC | Hash-based Message Authentication Code | 基于哈希函数和密钥的消息认证代码        |
| AES  | Advanced Encryption Standard           | 高级加密标准                  |
| RSA  | Rivest–Shamir–Adleman                  | 罗纳德·李维斯特、阿迪·萨莫尔、伦纳德·阿德曼 |
| DH   | Diffie-Hellman                         | 迪菲-赫尔曼密钥交换              |
| ECDH | Elliptic-curve Diffie–Hellman          | 椭圆曲线迪菲-赫尔曼密钥交换          |
